<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>PARKFACIL ‚Äì Control de Estacionamiento</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial;
  background:#f5f7fa;
}
.layout{
  display:flex;
  min-height:100vh;
}

/* SIDEBAR */
.sidebar{
  width:220px;
  background:#0f172a;
  color:#fff;
  display:flex;
  flex-direction:column;
}
.brand{
  padding:16px;
  font-size:18px;
  border-bottom:1px solid #334155;
}
.brand span{
  cursor:pointer;
  margin-right:8px;
}
.menu div{
  padding:14px 16px;
  cursor:pointer;
}
.menu div:hover{
  background:#1e293b;
}

/* CONTENT */
.content{
  flex:1;
  padding:24px;
}
.seccion{
  display:none;
  max-width:420px;
}
.seccion.activa{
  display:block;
}

/* CARD */
.card{
  background:#fff;
  padding:24px;
  border-radius:12px;
  box-shadow:0 10px 25px rgba(0,0,0,.1)
}
h1{text-align:center}
label{font-weight:bold}
input,button{
  width:100%;
  padding:12px;
  margin-top:8px;
  font-size:16px
}
button{
  border:none;
  border-radius:8px;
  color:#fff;
  cursor:pointer
}
#btnIniciar{background:#2563eb}
#btnDetener{background:#dc2626}
#btnBuscar{background:#6b7280}
#btnWhatsapp{background:#25D366}
#btnMail{background:#0f172a}

.resultado{
  margin-top:16px;
  background:#f1f5f9;
  padding:12px;
  border-radius:8px;
  display:none
}
.sugerencias{
  border:1px solid #ddd;
  border-radius:6px;
  margin-top:6px;
  display:none;
  max-height:150px;
  overflow-y:auto
}
.sugerencias div{
  padding:8px;
  cursor:pointer;
  border-bottom:1px solid #e5e7eb
}
.sugerencias div:hover{
  background:#e5e7eb
}

/* MOBILE */
@media(max-width:768px){
  .sidebar{
    position:fixed;
    left:-220px;
    top:0;
    height:100%;
    transition:.3s;
    z-index:10;
  }
  .sidebar.open{
    left:0;
  }
}
</style>
</head>

<body>
<div class="layout">

<!-- SIDEBAR -->
<div id="sidebar" class="sidebar">
  <div class="brand">
    <span onclick="toggleSidebar()">‚ò∞</span> PARKFACIL
  </div>
  <div class="menu">
    <div onclick="mostrarSeccion('operacion')">üöó Operaci√≥n</div>
    <div onclick="mostrarSeccion('reportes')">üìä Reportes</div>
    <div onclick="mostrarSeccion('cierre')">üîê Cierre</div>
    <div onclick="mostrarSeccion('config')">‚öôÔ∏è Configuraci√≥n</div>
  </div>
</div>

<!-- CONTENT -->
<div class="content">

<!-- OPERACION -->
<div id="operacion" class="seccion activa">
  <div class="card">
    <h1>Control de Estacionamiento</h1>

    <label>Patente</label>
    <input id="patente" placeholder="CX-PY-95" maxlength="8">

    <div id="listaPatentes" class="sugerencias"></div>

    <button id="btnIniciar">Iniciar estad√≠a</button>
    <button id="btnDetener">Detener estad√≠a</button>
    <button id="btnBuscar">Buscar patente</button>

    <div id="resultado" class="resultado"></div>

    <button id="btnWhatsapp" style="display:none">Enviar por WhatsApp</button>
    <button id="btnMail" style="display:none">Enviar por Email</button>
  </div>
</div>

<!-- REPORTES -->
<div id="reportes" class="seccion">
  <h2>üìä Reportes</h2>
  <p>Pr√≥ximamente: reportes diarios y exportaci√≥n.</p>
</div>

<!-- CIERRE -->
<div id="cierre" class="seccion">
  <h2>üîê Cierre de Turno</h2>
  <p>Pr√≥ximamente: cierre por operador.</p>
</div>

<!-- CONFIG -->
<div id="config" class="seccion">
  <h2>‚öôÔ∏è Configuraci√≥n</h2>
  <p>Pr√≥ximamente: tarifas, impresora, QR.</p>
</div>

</div>
</div>

<script>
const VALOR_POR_MINUTO = 30;
const IVA = 0.19;

const inputPatente = document.getElementById('patente');
const resultado = document.getElementById('resultado');
const lista = document.getElementById('listaPatentes');
const btnWhatsapp = document.getElementById('btnWhatsapp');
const btnMail = document.getElementById('btnMail');

let ultimoTicket = '';

/* NAV */
function mostrarSeccion(id){
  document.querySelectorAll('.seccion').forEach(s=>s.classList.remove('activa'));
  document.getElementById(id).classList.add('activa');
  document.getElementById('sidebar').classList.remove('open');
}
function toggleSidebar(){
  document.getElementById('sidebar').classList.toggle('open');
}

/* PATENTE FORMAT */
inputPatente.addEventListener('input', ()=>{
  let raw = inputPatente.value.toUpperCase().replace(/[^A-Z0-9]/g,'');
  let out = raw.substring(0,2);
  if(raw.length>2) out+='-'+raw.substring(2,4);
  if(raw.length>4) out+='-'+raw.substring(4,6);
  inputPatente.value = out;
});

/* BUTTONS */
btnBuscar.onclick = buscarPatentes;
btnWhatsapp.onclick = enviarWhatsapp;
btnMail.onclick = enviarMail;
document.getElementById('btnIniciar').onclick = iniciar;
document.getElementById('btnDetener').onclick = detener;

/* LOGICA */
function iniciar(){
  const p=inputPatente.value;
  if(!/^[A-Z]{2}-[A-Z]{2}-\d{2}$/.test(p)){alert('Patente inv√°lida');return;}
  localStorage.setItem(p,JSON.stringify({entrada:new Date().toISOString()}));
  alert('Estad√≠a iniciada');
}

function buscarPatentes(){
  lista.innerHTML='';
  lista.style.display='block';
  const patentes=Object.keys(localStorage)
    .filter(k=>/^[A-Z]{2}-[A-Z]{2}-\d{2}$/.test(k));
  if(!patentes.length){
    lista.innerHTML='<div>No hay patentes</div>';
    return;
  }
  patentes.forEach(p=>{
    const d=document.createElement('div');
    d.textContent=p;
    d.onclick=()=>{inputPatente.value=p;lista.style.display='none';};
    lista.appendChild(d);
  });
}

function detener(){
  const p=inputPatente.value;
  const d=localStorage.getItem(p);
  if(!d){alert('No encontrada');return;}
  const e=new Date(JSON.parse(d).entrada);
  const s=new Date();
  const min=Math.max(1,Math.floor((s-e)/60000));
  const tot=Math.round(min*VALOR_POR_MINUTO*(1+IVA));
  localStorage.removeItem(p);

  ultimoTicket=
`TICKET PARKFACIL
Patente: ${p}
Entrada: ${e.toLocaleString()}
Salida: ${s.toLocaleString()}
Minutos: ${min}
Total: $${tot}`;

  resultado.style.display='block';
  resultado.innerHTML=ultimoTicket.replace(/\n/g,'<br>');
  btnWhatsapp.style.display='block';
  btnMail.style.display='block';
}

function enviarWhatsapp(){
  window.open(`https://wa.me/?text=${encodeURIComponent(ultimoTicket)}`,'_blank');
}
function enviarMail(){
  window.location.href=`mailto:?subject=Ticket Estacionamiento&body=${encodeURIComponent(ultimoTicket)}`;
}
</script>
</body>
</html>
